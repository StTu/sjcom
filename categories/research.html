
<!-- Category Layout Start -->

<!DOCTYPE html>
<html lang="en">

  
<!-- HEAD Start -->

<head>
  


  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Research page for Stuart James">
  <meta name="author" content="Stuart James">
  <meta name="keywords" content="stuart, james, personal, research">
  <link rel="canonical" href="//categories/research.html">
  <title>{ Stuart James } | research</title>

  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link href="/css/grayscale.css" rel="stylesheet">
  
  <link href="/css/timeline.css" rel="stylesheet">
  
  <link href="/css/bootstrap-social.css" rel="stylesheet">
  <link href="/css/animate.min.css" rel="stylesheet">
  <!-- Custom Fonts -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="//css/rrssb.css" />
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  
    <link rel="shortcut icon" type="image/x-icon" href="//img/favicon.ico">
  

  

  


  <!-- iOS Web App mode -->

  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" sizes="36x36" href="//img/web-app/icon-36p.png">
  <link rel="apple-touch-icon" sizes="48x48" href="//img/web-app/icon-48p.png">
  <link rel="apple-touch-icon" sizes="72x72" href="//img/web-app/icon-72p.png">
  <link rel="apple-touch-icon" sizes="96x96" href="//img/web-app/icon-96p.png">
  <link rel="apple-touch-icon" sizes="144x144" href="//img/web-app/icon-144p.png">
  <link rel="apple-touch-icon" sizes="192x192" href="//img/web-app/icon-192p.png">

  <!-- Android Web App mode -->

  <link rel="manifest" href="//manifest.json">




  
<!-- Chrome, Firefox OS and Opera -->
<meta name="theme-color" content="#000000">
<!-- Windows Phone -->
<meta name="msapplication-navbutton-color" content="#000000">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">


  



</head>

<!-- HEAD End -->


  <body>

    
<!-- Navigation Start -->

<nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
        <i class="fa fa-bars"></i>
      </button>
      
        <a class="navbar-brand" href="//">
      
          <div>
            
              <img src="//img/black-lab-glass.ico" alt="">
            
            { Stuart James }
          </div>
        </a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
      <ul class="nav navbar-nav">
        
          <!-- Blog, Post, Tag and Error pages -->
          
            <li>
            
                <a href="//#about"> About </a>
            
            </li>
          
            <li>
            
                <a class="page-scroll" href="//cv/"> Résumé </a>
            
            </li>
          
            <li>
            
              
                <a href="//blog/"> Blog </a>
              
            
            </li>
          
            <li>
            
                <a href="//#newsfeed"> News Feed </a>
            
            </li>
          
            <li>
            
                <a href="//publications/"> Publications </a>
            
            </li>
          
            <li>
            
                <a href="//#contact"> Contact </a>
            
            </li>
          
        
      </ul>
    </div>
  </div>
</nav>

<!-- Navigation End -->


    <section class="container content-section text-center">
      <div class="row">
        <div class="col-md-10 col-md-offset-1 col-xs-10 col-xs-offset-1">

          

          <h3 id="#research">Category: research</h3>

          <div>
            
              
                
<!-- Post List Start -->

<h4 align="left">
  <strong>26 Aug 2016</strong>
  <small>.
    <a class="category" href="//categories/research.html">
      research
    </a>
  .</small>
  <br class="visible-xs-block">
  <a href="//research/2016/08/26/british-library-dataset-style-transfer.html">
    <strong>Transferring old book image style to real world photos</strong>
  </a>
  <small><a href="//research/2016/08/26/british-library-dataset-style-transfer.html#disqus_thread">Comments</a></small>
  <br class="visible-xs-block">
  </h4>
  <div style="text-align: justify;">
    
                        <div class="image featured wrapper">
                                <img src="/images/blog/2016-08-26-style.jpg" alt="" />
                            
        <a href="//research/2016/08/26/british-library-dataset-style-transfer.html" class="image featured">

            </a>
                        
                            <div class="image featured cite">
                                    <a href="https://www2.eecs.berkeley.edu/Research/Projects/CS/vision/grouping/resources.html">Original Image from BSDS500 Dataset</a>
                            </div>
                        
                        </div>
    
    <p>
Style transfer has become a popular area of research and with public applications such as Prisma based on Neural Style Transfer [Gatys'15]. Earlier this week I wanted to answer the question does it really work for understanding the larger style and context. In contrast to [Wang'13] where they learnt an artistic stroke style, how does it compare. The British Library Flickr 1m+ dataset [BL'13] provides an interesting application of this, where there is an inherent style for transferring. 
</p>
<!--more-->

<p>
So having read the papers around this previously, I was fairly sure it would not transfer very well, but on the chance that local statistics can enforce something coherent it was worth running (and also gave me a chance to play with such networks). So by taking a few examples, these are the best results from transferring from the BL'13 to the <a href="https://www2.eecs.berkeley.edu/Research/Projects/CS/vision/grouping/resources.html">Berkeley Segmentation Dataset (BSDS500) [BSDS500'11]</a>
</p>

<p><img style="width:100%" src="/images/blog/2016-08-26-style-collage.png" /></p>

<p>
    These results were achieved using the Texture Nets method [Ulyanov'16] trained on a singular example and the most visually appealing results displayed after playing with the Texture / Style weights as well as the chosen example. Code available on <a href="https://github.com/DmitryUlyanov/texture_nets">GitHub</a>
</p>
<p>
<img style="max-width:32%; float: left;" src="/images/blog/2016-08-26-style-example.jpg" />
<img style="max-width:32%; float: left;" src="/images/blog/2016-08-26-style-bsd500.jpg" />
<img style="max-width:32%; float: left;" src="/images/blog/2016-08-26-style-bsd500-stylaized.jpg" />
</p>
<p>
 What is quite interesting is if you look at this from a distance they look plausible, but it isn't till you look at one adjacent to another or zoom in you realize that these aren't actually the same style. Logical hatching patterns to describe shadows or depth are ignored, or in the cases where they are present they don't make sense. 
</p>

<p>
As a mini-conclusion, style-transfer, although gaining a lot of hype has still a long way to being accurately reproduce general artistic style. Still the results are interesting and if you aren't looking for exact replication, then it is visually appealing. It must be bared in mind that the British Library dataset is challenging, where the style has been evolving for human understanding over millenniums. A problem to keep working on, possibly guided by transfer learning.
</p>

<h3>References</h3>
<p>[Gatys'15] Leon A Gatys and Alexander S Ecker and Matthias Bethge. "A Neural Algorithm of Artistic Style". Arxiv (http://arxiv.org/abs/1508.06576). 2015.
<br />
[Wang'13] T Wang and J Collomosse and D Greig and A Hunter. "Learnable Stroke Models for Example-based Portrait Painting". Proc. British Machine Vision Conference (BMVC). 2013.
<br />
[BL'13] British Library Flickr. https://www.flickr.com/photos/britishlibrary/. 2013.
<br />
[BSDS500'11] Berkeley Segmentation Dataset. https://www2.eecs.berkeley.edu/Research/Projects/CS/vision/grouping/resources.html#bsds500. 2011
<br />
[Ulyanov'16] Dmitry Ulyanov and Vadim Lebedev and Andrea Vedaldi and Victor Lempitsky. "Texture Networks: Feed-forward Synthesis of Textures and Stylized Images. Arxiv (http://arxiv.org/abs/1603.03417). 2016.
</p>

  </div>
  <br class="visible-xs-block">

<!-- Post List End -->
              
            
              
            
              
            
              
            
              
            
              
                
<!-- Post List Start -->

<h4 align="left">
  <strong>20 Apr 2016</strong>
  <small>.
    <a class="category" href="//categories/research.html">
      research
    </a>
  .</small>
  <br class="visible-xs-block">
  <a href="//research/2016/04/20/working-with-british-library-dataset.html">
    <strong>Working with the British Library Dataset</strong>
  </a>
  <small><a href="//research/2016/04/20/working-with-british-library-dataset.html#disqus_thread">Comments</a></small>
  <br class="visible-xs-block">
  </h4>
  <div style="text-align: justify;">
    
                        <div class="image featured wrapper">
                                <img src="/images/blog/2016-04-20-header.jpg" alt="" />
                            
        <a href="//research/2016/04/20/working-with-british-library-dataset.html" class="image featured">

            </a>
                        
                            <div class="image featured cite">
                                    <a href="https://www.flickr.com/photos/britishlibrary/11242704503/">British Library -- Flickr</a>
                            </div>
                        
                        </div>
    
    <p>Earlier this year <a href="http://tim.weyri.ch">Tim Weyrich</a> directed me onto a dataset published by the British Library and since then my research has focused heavily around this. Within Computer Vision it is unusual to get a large dataset not skewed to achieve a specific research goal. Sometimes datasets can be repurposed, but this is requires extensive effort to get the data in its rawest form.</p>

<p>The British Library dataset is a quite literally a "dump" of all the unknown to OCR elements from the book scanning performed by Microsoft. Therefore is not just a collection of line art imagery, but also of elaborate charachters or section embroidery.</p>

<!--more-->

<p>I intend to post more on working with this dataset as time goes on, but for now there is a github which contains the directory of images:
<a href="https://github.com/BL-Labs/imagedirectory">Directory of Images (Github)</a></p>

<p>And what is the main repository on Flickr:<a href="https://www.flickr.com/photos/britishlibrary/">Flickr Repository</a>

</p>

  </div>
  <br class="visible-xs-block">

<!-- Post List End -->
              
            
              
            
              
            
              
            
              
                
<!-- Post List Start -->

<h4 align="left">
  <strong>07 Jul 2014</strong>
  <small>.
    <a class="category" href="//categories/research.html">
      research
    </a>
  .</small>
  <br class="visible-xs-block">
  <a href="//research/2014/07/07/libsvm-linear-kernel-normalisation.html">
    <strong>libSVM linear kernel normalisation</strong>
  </a>
  <small><a href="//research/2014/07/07/libsvm-linear-kernel-normalisation.html#disqus_thread">Comments</a></small>
  <br class="visible-xs-block">
  </h4>
  <div style="text-align: justify;">
    
                        <div class="image featured wrapper">
                                <img src="//images/blog/fnsys-06-00059-g002.jpg" alt="" />
                            
        <a href="//research/2014/07/07/libsvm-linear-kernel-normalisation.html" class="image featured">

            </a>
                        
                            <div class="image featured cite">
                                    Image taken from <a href="http://toublanc.info/support/support-vector-machines-python">Tou Blanc </a>
                            </div>
                        
                        </div>
    
    <p>I have used a variety of tools for binary, multiclass and even incremental SVM problems, today I found something quite nice in binary case for <a href="http://www.csie.ntu.edu.tw/~cjlin/libsvm/">libSVM</a>, although potentially a source of confusion.</p>
<p>It is common in machine learning to apply a sigmoid function to normalise the boundaries of a problem, this can by empirically defining the upper and lower bound or through experimentation. Within <a href="http://www.csie.ntu.edu.tw/~cjlin/libsvm/">libSVM</a> they do this through experimentation, that is great to save you some time. The only thing to remember is it means through the use of random and cross validation with small sets of data, you are likely to get different results on each run.</p>
<p>So the function to consider is this:</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code>
<span class="c1">// Cross-validation decision values for probability estimates
</span><span class="k">static</span> <span class="kt">void</span> <span class="n">svm_binary_svc_probability</span><span class="p">(</span>
	<span class="k">const</span> <span class="n">svm_problem</span> <span class="o">*</span><span class="n">prob</span><span class="p">,</span> <span class="k">const</span> <span class="n">svm_parameter</span> <span class="o">*</span><span class="n">param</span><span class="p">,</span>
	<span class="kt">double</span> <span class="n">Cp</span><span class="p">,</span> <span class="kt">double</span> <span class="n">Cn</span><span class="p">,</span> <span class="kt">double</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">probA</span><span class="p">,</span> <span class="kt">double</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">probB</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nr_fold</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">perm</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">);</span>
	<span class="kt">double</span> <span class="o">*</span><span class="n">dec_values</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">);</span>

	<span class="c1">// random shuffle
</span>	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="p">(</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="o">-</span><span class="n">i</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">nr_fold</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">begin</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="o">/</span><span class="n">nr_fold</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="o">/</span><span class="n">nr_fold</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">svm_problem</span> <span class="n">subprob</span><span class="p">;</span>

		<span class="n">subprob</span><span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="o">-</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">begin</span><span class="p">);</span>
		<span class="n">subprob</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">svm_node</span><span class="o">*</span><span class="p">,</span><span class="n">subprob</span><span class="p">.</span><span class="n">l</span><span class="p">);</span>
		<span class="n">subprob</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span><span class="n">subprob</span><span class="p">.</span><span class="n">l</span><span class="p">);</span>
			
		<span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">subprob</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
			<span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">y</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
			<span class="o">++</span><span class="n">k</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">subprob</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
			<span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">y</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
			<span class="o">++</span><span class="n">k</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="kt">int</span> <span class="n">p_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">k</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">0</span><span class="p">)</span>
				<span class="n">p_count</span><span class="o">++</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">n_count</span><span class="o">++</span><span class="p">;</span>

		<span class="k">if</span><span class="p">(</span><span class="n">p_count</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">n_count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">p_count</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">n_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">p_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">n_count</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">svm_parameter</span> <span class="n">subparam</span> <span class="o">=</span> <span class="o">*</span><span class="n">param</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">probability</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">nr_weight</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight_label</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=+</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight_label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">Cp</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">Cn</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">svm_model</span> <span class="o">*</span><span class="n">submodel</span> <span class="o">=</span> <span class="n">svm_train</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">subprob</span><span class="p">,</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">subparam</span><span class="p">);</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">svm_predict_values</span><span class="p">(</span><span class="n">submodel</span><span class="p">,</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;(</span><span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]));</span> 
				<span class="c1">// ensure +1 -1 order; reason not using CV subroutine
</span>				<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">*=</span> <span class="n">submodel</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="p">}</span>		
			<span class="n">svm_free_and_destroy_model</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">submodel</span><span class="p">);</span>
			<span class="n">svm_destroy_param</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">subparam</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">free</span><span class="p">(</span><span class="n">subprob</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
		<span class="n">free</span><span class="p">(</span><span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
	<span class="p">}</span>		
	<span class="n">sigmoid_train</span><span class="p">(</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">,</span><span class="n">dec_values</span><span class="p">,</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">y</span><span class="p">,</span><span class="n">probA</span><span class="p">,</span><span class="n">probB</span><span class="p">);</span>
	<span class="n">free</span><span class="p">(</span><span class="n">dec_values</span><span class="p">);</span>
	<span class="n">free</span><span class="p">(</span><span class="n">perm</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>So if you have few numbers of samples, that is the case in some circumstances then the cross validation is where you hit problems. Of course you can simply re-implement it yourself or you can add a few lines to stop cross validation if the number of samples is too few.&lt;p&gt;<br />&lt;/p&gt;&lt;p&gt;Not the most elegant of code, but for the moment it will do. I choose to completely seperate the two steps as opposed to multiple if’s&lt;/p&gt;&lt;pre class="brush: c++; toolbar: false"&gt;static void svm_binary_svc_probability(</p>
<div class="language-cpp highlighter-rouge"><pre class="highlight"><code>	<span class="k">const</span> <span class="n">svm_problem</span> <span class="o">*</span><span class="n">prob</span><span class="p">,</span> <span class="k">const</span> <span class="n">svm_parameter</span> <span class="o">*</span><span class="n">param</span><span class="p">,</span>
	<span class="kt">double</span> <span class="n">Cp</span><span class="p">,</span> <span class="kt">double</span> <span class="n">Cn</span><span class="p">,</span> <span class="kt">double</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">probA</span><span class="p">,</span> <span class="kt">double</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">probB</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nr_fold</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">perm</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">);</span>
	<span class="kt">double</span> <span class="o">*</span><span class="n">dec_values</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">);</span>

	<span class="c1">// random shuffle
</span>	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="p">(</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="o">-</span><span class="n">i</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">perm</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">nr_fold</span><span class="p">)){</span>
		<span class="kt">int</span> <span class="n">begin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span>

		<span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">svm_problem</span> <span class="n">subprob</span><span class="p">;</span>

		<span class="n">subprob</span><span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span>
		<span class="n">subprob</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">svm_node</span><span class="o">*</span><span class="p">,</span><span class="n">subprob</span><span class="p">.</span><span class="n">l</span><span class="p">);</span>
		<span class="n">subprob</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span><span class="n">subprob</span><span class="p">.</span><span class="n">l</span><span class="p">);</span>
			
		<span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">subprob</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
			<span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">y</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
			<span class="o">++</span><span class="n">k</span><span class="p">;</span>
		<span class="p">}</span>


		<span class="kt">int</span> <span class="n">p_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">k</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">0</span><span class="p">)</span>
				<span class="n">p_count</span><span class="o">++</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">n_count</span><span class="o">++</span><span class="p">;</span>

		<span class="k">if</span><span class="p">(</span><span class="n">p_count</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">n_count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">p_count</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">n_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">p_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">n_count</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">svm_parameter</span> <span class="n">subparam</span> <span class="o">=</span> <span class="o">*</span><span class="n">param</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">probability</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">nr_weight</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight_label</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=+</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight_label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">Cp</span><span class="p">;</span>
			<span class="n">subparam</span><span class="p">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">Cn</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">svm_model</span> <span class="o">*</span><span class="n">submodel</span> <span class="o">=</span> <span class="n">svm_train</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">subprob</span><span class="p">,</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">subparam</span><span class="p">);</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">svm_predict_values</span><span class="p">(</span><span class="n">submodel</span><span class="p">,</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;(</span><span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]));</span> 
				<span class="c1">// ensure +1 -1 order; reason not using CV subroutine
</span>				<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">*=</span> <span class="n">submodel</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="p">}</span>		
			<span class="n">svm_free_and_destroy_model</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">submodel</span><span class="p">);</span>
			<span class="n">svm_destroy_param</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">subparam</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">free</span><span class="p">(</span><span class="n">subprob</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
		<span class="n">free</span><span class="p">(</span><span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
	<span class="p">}</span><span class="k">else</span><span class="p">{</span>
		<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">nr_fold</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">begin</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="o">/</span><span class="n">nr_fold</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="o">/</span><span class="n">nr_fold</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">nr_fold</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
				<span class="n">begin</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span>
				<span class="n">end</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="kt">int</span> <span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">svm_problem</span> <span class="n">subprob</span><span class="p">;</span>

			<span class="n">subprob</span><span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="o">-</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">begin</span><span class="p">);</span>
			<span class="n">subprob</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">svm_node</span><span class="o">*</span><span class="p">,</span><span class="n">subprob</span><span class="p">.</span><span class="n">l</span><span class="p">);</span>
			<span class="n">subprob</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span><span class="n">subprob</span><span class="p">.</span><span class="n">l</span><span class="p">);</span>
			
			<span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">subprob</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
				<span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">y</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">subprob</span><span class="p">.</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
				<span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">y</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
				<span class="o">++</span><span class="n">k</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="kt">int</span> <span class="n">p_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">k</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="k">if</span><span class="p">(</span><span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mi">0</span><span class="p">)</span>
					<span class="n">p_count</span><span class="o">++</span><span class="p">;</span>
				<span class="k">else</span>
					<span class="n">n_count</span><span class="o">++</span><span class="p">;</span>

			<span class="k">if</span><span class="p">(</span><span class="n">p_count</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">n_count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
				<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
					<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">p_count</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">n_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
					<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">p_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">n_count</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
					<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="n">svm_parameter</span> <span class="n">subparam</span> <span class="o">=</span> <span class="o">*</span><span class="n">param</span><span class="p">;</span>
				<span class="n">subparam</span><span class="p">.</span><span class="n">probability</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
				<span class="n">subparam</span><span class="p">.</span><span class="n">C</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span>
				<span class="n">subparam</span><span class="p">.</span><span class="n">nr_weight</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
				<span class="n">subparam</span><span class="p">.</span><span class="n">weight_label</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
				<span class="n">subparam</span><span class="p">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">Malloc</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
				<span class="n">subparam</span><span class="p">.</span><span class="n">weight_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=+</span><span class="mi">1</span><span class="p">;</span>
				<span class="n">subparam</span><span class="p">.</span><span class="n">weight_label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
				<span class="n">subparam</span><span class="p">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">Cp</span><span class="p">;</span>
				<span class="n">subparam</span><span class="p">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">Cn</span><span class="p">;</span>
				<span class="k">struct</span> <span class="n">svm_model</span> <span class="o">*</span><span class="n">submodel</span> <span class="o">=</span> <span class="n">svm_train</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">subprob</span><span class="p">,</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">subparam</span><span class="p">);</span>
				<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">begin</span><span class="p">;</span><span class="n">j</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">end</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">svm_predict_values</span><span class="p">(</span><span class="n">submodel</span><span class="p">,</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">x</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;(</span><span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]));</span> 
					<span class="c1">// ensure +1 -1 order; reason not using CV subroutine
</span>					<span class="n">dec_values</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">*=</span> <span class="n">submodel</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="p">}</span>		
				<span class="n">svm_free_and_destroy_model</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">submodel</span><span class="p">);</span>
				<span class="n">svm_destroy_param</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">subparam</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">free</span><span class="p">(</span><span class="n">subprob</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
			<span class="n">free</span><span class="p">(</span><span class="n">subprob</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">sigmoid_train</span><span class="p">(</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">l</span><span class="p">,</span><span class="n">dec_values</span><span class="p">,</span><span class="n">prob</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">y</span><span class="p">,</span><span class="n">probA</span><span class="p">,</span><span class="n">probB</span><span class="p">);</span>
	<span class="n">free</span><span class="p">(</span><span class="n">dec_values</span><span class="p">);</span>
	<span class="n">free</span><span class="p">(</span><span class="n">perm</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>
<p><br /></p>
<p>As with a lot of my code based posts, this is more for my memory than anything, but hopefully may help people unlock the secrets of <a href="http://www.csie.ntu.edu.tw/~cjlin/libsvm/">libSVM</a>.</p>

  </div>
  <br class="visible-xs-block">

<!-- Post List End -->
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
          </div>

        </div>
      </div>
    </section>

    <!-- Footer Start -->

<footer>

    <!-- Social Buttons Start -->

<ul class="list-inline social-buttons">
    
    <li><a href="https://facebook.com/StuartAaronJames" target="_blank"><i class="fa fa-facebook fa-fw"></i></a></li>
    
    <li><a href="https://twitter.com/StTuJames" target="_blank"><i class="fa fa-twitter fa-fw"></i></a></li>
    
    <li><a href="https://github.com/StTuJames" target="_blank"><i class="fa fa-github fa-fw"></i></a></li>
    
    <li><a href="/feed.xml" target="_blank"><i class="fa fa-rss fa-fw"></i></a></li>
    
    
</ul>

<!-- Social Buttons End -->


    <p><br><br></p>

    <div class="container text-center">
        <p>Copyright &copy; Stuart James 2016</p>
        
    </div>
</footer>

<p><br><br><br></p>

<!-- Footer End -->


    
<!-- Javascript Start -->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

<!-- Custom Theme JavaScript -->
<!--* Start Bootstrap - Grayscale Bootstrap Theme (http://startbootstrap.com)
* Code licensed under the Apache License v2.0.
* For details, see http://www.apache.org/licenses/LICENSE-2.0.-->
<script>
function toggleNavCollapse(){50<$(".navbar").offset().top?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse");}
$(document).ready(toggleNavCollapse);
$(window).scroll(toggleNavCollapse);$(function(){$("a.page-scroll").bind("click",function(b){var a=$(this);$("html, body").stop().animate({scrollTop:$(a.attr("href")).offset().top-50},1500,"easeInOutExpo",function(){a.blur()});b.preventDefault()})});$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()});
</script>






  

  <!-- Google Tracking Id Start -->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-7794553-6', 'auto');
    ga('send', 'pageview');
  </script>

  <!-- Google Tracking Id End -->

  




  <!-- Disqus -->

  

  







<script>
function addTohistory() {
  if (!window.location.host.startsWith("127.0.0.1")) {
    history.pushState({}, 'research', 'http://stuart-james.com//categories/research.html');
  }
}
</script>

<!-- Gesture Navigation / Swipe Instruction Start -->


  

  

  

  

<!-- Gesture Navigation / Swipe Instruction End -->


<script src="/js/wow.min.js"></script>
<!-- Javascript End -->


  </body>
</html>

<!-- Category Layout End -->
